import {Platform} from './platform.js';

export class ComponentNavigation {
    constructor() {
        this._combinations = new Map([
            ["ctrl + alt + m", this._toggleMenu],
            ["ctrl + alt + t", this._toggleAssistant],
            ["ctrl + alt + n", this._createNewRecord],
            ["ctrl + alt + e", this._toggleMessages],
        ]);

        this._platform = new Platform();
        this._keyupHandler = this._keyup.bind(this);
        
        window.addEventListener("keyup", this._keyupHandler);
    }
    
    dispose() {
        window.removeEventListener("keyup", this._keyupHandler);
        
        this._platform.dispose();
        this._platform = null;
        this._keyupHandler = null;
        this._combinations = null;
    }

    /**
     * Keyup event handler
     * @param event
     * @private
     */
    _keyup(event) {
        const combo = this._platform.keycombo(event);

        if (combo && this._combinations.has(combo)) {
            const shortcut = this._combinations.get(combo);
            shortcut.apply(this, [event]);
        }
    }

    // noinspection JSMethodCanBeStatic
    /**
     * Invokes the toggle method on the menu
     * @private
     */
    _toggleMenu() {
        const component = document.querySelector("pragma-menu");
        
        if (component != null) {
            component.toggle();
        } 
    }

    // noinspection JSMethodCanBeStatic
    /**
     * Invokes the toggle method on the assist
     * @private
     */
    _toggleAssistant() {
        const component = document.querySelector("pragma-assistant");

        if (component != null) {
            component.toggleAssist();
        }
    }

    // noinspection JSMethodCanBeStatic
    /**
     * Toggles the messages component
     * @private
     */
    _toggleMessages() {
        const component = document.querySelector("pragma-messages");
        
        if(component != null) {
            component.toggle();
        }
    }

    // noinspection JSMethodCanBeStatic
    /**
     * Performs a click on the assist create button
     * @private
     */
    _createNewRecord() {
        this._click("#assistantCreate");
    }

    // noinspection JSMethodCanBeStatic
    /**
     * Invokes the toggle method on the assist
     * @private
     */
    _click(selector) {
        const button = document.querySelector(selector);
        
        if (button != null) {
            button.click();
        } 
    }
}