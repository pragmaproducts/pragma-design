# Pragma Context Menu Component

This document describes the required features for the pragma-context-menu component.

## Design
https://projects.invisionapp.com/d/main/default/#/projects/prototypes/16702208

## Component

Name: pragma-context-menu

Context menu is a custom component that appears upon user interaction, such as a right-click mouse operation. It offers
a limited set of choices that are available in the current state, or context of the target element / selected data.

Component has the same lifespan as the application, this is because the component is responsible for rendering the context
menu items for any visualisation that emits a message to it and must be available for the lifespan of the app. It is
registered on app load.

## UI

Component will contain the following elements:

1. pragma-panel-list

## Accessibility

#### WAI-ARIA:

1. menu - This role will be specified for an item which have sub menus.
1. menuItem - This role will be specified for an item that do not have sub menus.
1. aria-expanded - Indicates whether the subtree can be expanded or collapsed, as well as indicates whether its current
state is expanded or collapsed.

#### Keyboard Behaviour

1. Shift + F10 - Launch context menu for currently focused element. (TBD in calling element/component)
1. Esc - Closes the opened context menu.
1. Enter - Selects the focused item. (TBI in pragma-advanced-list)
1. Up - Navigates up or to the previous menu item. (TBI in pragma-advanced-list)
1. Down - Navigates down or to the next menu item. (TBI in pragma-advanced-list)
1. Left - Close the current sub menu and navigates to the parent menu. (TBI in pragma-advanced-list)
1. Right - Navigates and open the next sub menu. (TBI in pragma-advanced-list)

#### Mouse Behaviour

1. Right click to launch context menu.

#### Touch Behaviour

1. Touch and hold (long press) on target element to launch context menu. (TBT on iOS)

#### Focus Behaviour

1. Focus first focusable element when context menu loads.
1. Return focus to source visualisation when context menu closes. (Refactor Dialog-Base first.)

## Usage

The component is used in the HTML markup. The following is a example of how it is used.

```html
<pragma-context-menu></pragma-context-menu>
```

## Features

#### State driven

The context menu is state driven, has a property ***state***. This property has 2 values either 'Open' or 'Closed'.
When the menuState is 'Closed', the component class list will include 'hidden' and the WAI-ARIA attribute of 'aria-hidden'
set to true. When 'Open' the aforementioned classes and attributes will be removed from the component.

An click outside the context menu or pressing the ESC key results in the context menu going back to its 'Closed' state.

#### Event Driven

pragma-context-menu will register an event called ***show-context-menu*** which takes a object as a parameter. This object
must include a property called ***menuItem*** which is an instance of type HierarchicalItem. As well as a property
***callback*** which is a reference to the callback handler on the source visualisation.

Thus each source visualisation will register its own ***contextmenu*** event listener and/or relevant shortcut. In the
event handler for the aforementioned event of the source visualisation, a event (***show-context-menu***) must be emitted
to the pragma-context-menu to render menu items. The message must contain an object parameter with the menu items
(hierarchical item structure) and the callback which will be triggered on selection. The menu item selected will be
returned as a parameter so that the source visualisation can do the relevant processing.

```javascript
const options = {
    event: event, //context-menu event object
    callback: this.someCallbackHandler,
    menuItems: [
                   {
                       id: 1,
                       title: "Menu Item 1",
                       description: "Menu Item 1",
                       items: [
                           {
                               id: 1.1,
                               title: "Sub Menu Item 1.1",
                               description: "Sub Menu Item 1.1",
                           },
                           {
                               id: 1.2,
                               title: "Sub Menu Item 1.2",
                               description: "Sub Menu Item 1.2",
                           }
                       ]
                   },
                   {
                       id: 2,
                       title: "Menu Item 2",
                       description: "Menu Item 2",
                       items: [
                           {
                               id: 2.1,
                               title: "Sub Menu Item 2.1",
                               description: "Sub Menu Item 2.1",
                           }
                       ]
                   },
                   {
                       id: 3,
                       title: "Menu Item 3",
                       description: "Menu Item 3"
                   }
               ]
};

window.eventEmitter.emit("show-context-menu", options);
```

#### Render

On ***state*** change to 'Open', the menu items for the target visualisation will be retrieved from the ***menuItems***
Map. These items will be rendered per depth, in a pragma-advanced-list. There will be 2 distinct templates, one for
parent items (has sub menu) and 1 for a child items (actionable menu item).

##### Positioning: Desktop

Context menu will be absolute positioned (must have the highest z-index) and the component need to will calculate its
position based on the target element, window offset and click position values, so that it is always in view port.

##### Positioning: Mobile

Context menu will be absolute positioned (must have the highest z-index) and take most of view port. No need to
calculate position.