# Pragma Query Parameters Panel

This document describes the required features for the pr-query-parameters-panel component.

## Component

Name: pr-query-parameters-panel

Component will be used to render a form with the parameterized queries for a given resource action. This component will
overlay visualizations prior to the bound data source load operation.

## Design

[InVision - Parameterized Query Design](https://projects.invisionapp.com/d/main/default/#/console/16778341/348927797/preview)

## UI

Component will contain the following elements:
1. pr-query-parameters
1. pragma-action-button "EDIT QUERY" (footer)
1. pragma-action-button "CONTINUE" (footer)

### Generation of schema

Schema for pragma-form will be generated from the resource actions api documentation, which will contain
a list of parameters. Each item in the list will provide details on the parameter, such as name, data type and default value. 

```
       "parameters": [
            {
                "name": "@test",
                "dataType": "boolean",
                "suppliedBy": "User",
                "defaultValue": true
            }
        ]
```

onkey-bridge middleware will be used to inflate data source definition with parameter names and values.

All parameter value inputs must be have the "required" attribute set.

## When to add component to DOM?

In data source setter on advanced-visualization-base (and pragma-chart?), evaluate "requires-parameter-values" property in schema, if true - load component.

## When is component removed from DOM?

Once user completes parameter values, component must be removed from all visualizations that share the data source.

## Render

The component will overlay the visualization prior/start of data source load operation.

## Accessibility

1. Role - dialog
1. aria-modal - true

## Focus Behaviour

1. Standard focus behaviour.

## Keyboard Behaviour

1. Standard input behaviour.

#### Comments

1. Investigate scenario where data source's are related and require some event driven loading from one to the other.

1. Refactor visualisation base implementation, create a datasource-element-base where common data source specific implementation can be added. 

1. Users are not allowed to cancel this operation, parameter values must be supplied or no data will be returned. 

1. Should there be a data source definition property for "use-default-parameter-values". If all parameter default values are specified then
do not load the pr-query-parameters-panel component and perform load operation with default values.

1. Not all users will have rights to view or edit resource criteria so the "Edit Query" button. Raise error specifying no rights.

1. How to cater for scenario where resource action criteria's parameter value is dependant on a selected value?
Use schema to specify where value originates from?

## Usage

The component is used in the pr-query-parameters-panel template HTML markup. The following is a example of how it is used.

```html
<pr-query-parameters-panel targetElement.bind="someVisualisation" datasource.bind="someDataSource"></pr-query-parameters-panel>
```

## Features

#### Edit Query

Once user clicks on the "Edit Query" button, the query builder component will be launched for the data source and display
as a modal taking most of view port. The "Parameters" tab will be visible in the query builder allowing user to specify
any changes there as well as modifying the original criteria. This component will be removed from the DOM.

Ensure removeChild called for layer, relevant memory disposed.

#### Continue

A schema side effect will be triggered for the data source definition, with the parameter values specified by the user.
(This will ensure parameter values are persisted on the schema for later use, for example opening up the query builder, the user should see the same values.)
If the user does not specify custom values, the default values will be used. (default values will be inflated and thus no
need to perform a schema change.) The load operation on the data source will be called manually so data is fetched.