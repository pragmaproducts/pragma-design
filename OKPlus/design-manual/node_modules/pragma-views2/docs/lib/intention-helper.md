# Intention Helper
This document describes the required features and the suggested implementation for the intention-helper.

## Purpose
Basically, we need to standardise the way events are registered and handled across the system, this will dry out the 
codebase and eliminate repetitive code. This should also apply the correct events on devices, e.g. if we are on a mobile
device, the correct events will be registered based on the intent of the user.   

## intent list and descriptions

This is a list of intentions, which may grow depending on what the user intends to do on the UI. these intentions 
use the mobile and desktop input events later we could add mobile gestures.

| __intent__   | __desktop__                       | __mobile__                                   |
|:--------------|:---------------------------------|:---------------------------------------------|
| click        | click Event                       | touch event                                  |
| doubleClick | dbClick Event                     | touchstart * 2 + duration                    |  
| inputUp      | mouseUp                           | touchEnd                                     |
| inputDown    | mouseDown                         | touchstart                                   |
| inputMove    | mousemove                         | touchmove                                    |
| contextmenu  | rightClick event                  | longPress (touchstart + touchend + duration) |
| zoomIn       | mousewheel                        | touchstart + touchmove + touchend (fingers)  |
| zoomOut      | mousewheel                        | touchstart + touchmove + touchend (fingers)  |

## touchEvent breakdown
For most, in fact for all intentions on mobile, there are only 4 touch events that are needed to 
achieve the desired effects on the element namely:

- `touchStart`
- `touchMove`
- `touchEnd`
- `touchCancel` (we will not need this, poc to be done when development event listeners)

reference link:  https://developer.mozilla.org/en-US/docs/Web/API/Touch_events

reference link: https://www.youtube.com/watch?v=ga_SLzsUdTY

## Touch events Compatibility
These touch events are fully supported on the respective mobile browsers except `Edge Mobile`
please refer to the below link: https://developer.mozilla.org/en-US/docs/Web/API/Touch_events for further information.

 ## transform gestures
Users can transform an elementâ€™s size, position, and rotation with gestures.

## Touch and mouse Event standards
Touch, mouse, and pointer events

Reference link: https://developers.google.com/web/fundamentals/design-and-ux/input/touch/

__w3 Documentation:__

W3 UI event are not clear as to the mapping of these desktop events to their mobile counterparts, but with that said, the standards
are basically identical for the following, however they have no default actions attached to them it is upto the developer and the application scenario to determine these actions.

- `click` For maximum accessibility, content authors are encouraged to use the click event type when defining activation behavior for custom controls, rather than other pointing-device event types such as mousedown or mouseup, which are more device-specific. Though the click event type has its origins in pointer devices (e.g., a mouse), subsequent implementation enhancements have extended it beyond that association, and it can be considered a device-independent event type for element activation
- `dbClick` As with the click event type, the default action of the dblclick event type varies based on the event target of the event and the value of the button or buttons attributes. Normally, the typical default actions of the dblclick event type match those of the click event type, with the following additional behavior
- `mousedown` Many implementations use the mousedown event to begin a variety of contextually dependent default actions. These default actions can be prevented if this event is canceled. Some of these default actions could include: beginning a drag/drop interaction with an image or link, starting text selection, etc. Additionally, some implementations provide a mouse-driven panning feature that is activated when the middle mouse button is pressed at the time the mousedown event is dispatched.
- `mousemove` In some implementation environments, such as a browser, mousemove events can continue to fire if the user began a drag operation (e.g., a mouse button is pressed) and the pointing device has left the boundary of the user agent.
- `mouseup` default action is to Invoke a context menu (in combination with the right mouse button, if supported),
`Many implementations will invoke a context menu as the default action of this event if the right mouse button is being released`

Reference link: https://www.w3.org/TR/touch-events/#list-of-touchevent-types

__iOS standard gestures:__
 
Reference link: https://developer.apple.com/design/human-interface-guidelines/ios/user-interaction/gestures/#standard-gestures

- `Tap` Activates a control or selects an item.
- `Double tap`. Zooms in and centers content or an image, or zooms out if already zoomed in.
- `Pinch`. Zooms in when pinching outward, zooms out when pinching inward.
- `Touch and hold`. When performed in editable or selectable text, displays a magnified view for cursor positioning. When performed in certain views, such as a collection view, enters a mode that allows items to be rearranged.
- `long-press`, is the same as the above mentioned `touch and hold` however the link below talks to a variation in the gesture driven implementation.

long-press link: https://developer.apple.com/documentation/uikit/touches_presses_and_gestures/handling_uikit_gestures/handling_long-press_gestures

__Android standard gestures:__

- `Tap`. Users can navigate to destinations by touching elements.
- `Tap and long-press`. The tap gesture and long press gesture each allow users to interact with elements and access additional functionality.
- `Double tap or pinch`. A pinch, or two quick taps, allows users to zoom into and out of content. (transform gesture)
- `puckup and move`. A long press and drag allows users to reorder content.(transform gesture)

Reference link:
https://developers.google.com/web/fundamentals/design-and-ux/input/touch/#touch_mouse_and_pointer_events

Reference link:
https://material.io/design/interaction/gestures.html#types-of-gestures


## mouseEvents vs TouchEvents intentions
|__intention__|__desktop action__|__mobile action__|
|---|---|---|
| click | leftClick | tap |
| variable intention| doubleClick|doubleTap|
| zoom | dblClick | doubleTap|
| contextmenu | right click | longPress or doubleTap |
| drag | click + hold + move | longPress + move |

## Implementation

before we can register any of the intentions, we need to create a list 
of these intentions above the class declaration.

```JS
const intents = {
    rightclick: 'rightclick',
    leftclick: 'leftclick'
};
```

we must also be able to know if the device we are working on is mobile or not,
we have a helper called isMobile() that already determines that.
so wee need to import it and use its result to set the intentions in the map.

```JS
import { isMobile} from "./device-helper.js";

export class IntentionHelper {
    constructor() {
       this._isMobile = isMobile();
    }
}
```

```JS

export class IntentionHelper {
    constructor(){
        this.startTime;
        this.endTime;
        this.timer = 0;
        this.latestTouch = 0;

        this._isMobile = isMobile();
        // we create a intentions map and set the different intentions,
        // and their respective callbacks depending on the device.
        this.intentions = new Map();
        this.intentions.set(intents.rightclick, this._isMobile ? this.longTouch : this.rightclick);
        this.intentions.set(intents.leftclick, this._isMobile ? this.singleTap : this.leftclick);
    }
    
    // we need a method that will register the intentions and the required eventListerners.
    registerIntention(element, intent, callback) {
        // 1 find the callback in the intentions map
        const handler = this.intentions.get(intent).bind(this, callback);
        // 2 if mobile register the touch events
        // 2.1 if desktop register click events
        if (this._isMobile) {
            element.addEventListener('touchstart', handler);
            element.addEventListener('touchend', handler);
        } else {
            element.addEventListener('mousedown', handler);
            element.addEventListener('mouseup', handler);
        }
    
    }    
    // We declare the functions that will handle the different intentions.
    
    rightclick(event) {
        event.preventDefault();
        let mbRight = event.button;
        if (mbRight === 0) { return; }
        event.target.style.setProperty('background-color', 'indigo');
        event.target.style.setProperty('color', 'white');
    }
  
    leftclick(event) {
        let mbLeft = event.button;
        if(mbLeft > 0) { return;}
        event.target.style.setProperty('background-color', 'dodgerblue');
        event.target.style.setProperty('color', 'white');
    }
    
    dispose() {
        //this thing need to clear the constructor variable as well as events when they are no longer needed.
    }
}
```